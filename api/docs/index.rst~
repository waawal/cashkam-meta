CashKamera Internal API documentation
=====================================

This is the internal documentation of the REST-like API for communication between the various frontends and the CashKamera backend.

Authentication
--------------

Validate a application user
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. http:post:: /auth

   Checks credentials and returns a authentication token valid for 90 days.
   
   It accepts :http:method:`post` only.

   :mimetype:`application/json`
   
   **Example response**:

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Vary: Accept
      Content-Type: application/json

        {
          "token": "adsdasdljn45345+kmfsd435l%km"
        }



   :form username: The username
   :type username: str
   :form password: The password
   :type password: str
   :status 200: User Authenticated.
   :status 400: Password or login is missing.
   :status 401: Authentication failed


Classified ad's
---------------

Post a ad
~~~~~~~~~

.. http:post:: /ads

   Posts a new classified ad.

   :mimetype:`application/json`

   :form image: base64 encoded image in JPEG
   :form header: Header for the ad.
   :type header: str
   :form body: Text for the ad.
   :type body: str
   :form token: The authentication hash.
   :type token: str
   :status 200: Classified ad created successfully.
   :status 400: when form parameters are missing.
   :status 403: Authentication didn't pass

Get a list of ads
~~~~~~~~~~~~~~~~~

.. http:get:: /ads

   Get a list of ads based on filters.

   **Example request**:

   .. sourcecode:: http

      GET /ads?limit=2&username=supercoolusername HTTP/1.1
      Host: cashk.am
      Accept: application/json, text/javascript

   **Example response**:

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Vary: Accept
      Content-Type: application/json

      [
        {
          "ad_id": 12345,
          "author_id": "supercoolusername",
          "active": true,
          "header": "Small shed",
          "image_small": "http://akamai.cashk.am/images/fsdfd98fdas_s.jpg",
          "image": "http://akamai.cashk.am/images/fsdfd98fdas.jpg"
        },
        {
          "ad_id": 12346,
          "author_id": "supercoolusername",
          "active": true,
          "header": null,
          "image_small": "http://akamai.cashk.am/images/fsdfd99fdas_s.jpg",
          "image": "http://akamai.cashk.am/images/fsdfd99fdas.jpg"
        }
      ]

   :query offset: offset number. default is 0
   :query limit: limit number. default is 10
   :query username: Username of the author.
   :query region: Name of geographical region
   :query coordinates: Coordinates, used together with coordinates-offset.
   :query coordinates-offset: Filters out ads based on requesters coordinates + the offset.
   :query text-header: Search the ad-headers for a pattern.
   :query text-all: Search the ad-headers and the ad-bodies for a pattern.
   :statuscode 200: no error.
   :statuscode 404: No ads found.
   :statuscode 400: when dependent queries are missing.


